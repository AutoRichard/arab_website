{"code":"module.exports=function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,\"a\",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p=\"/dist/\",o(o.s=14)}([function(e,t){e.exports=require(\"mongoose\")},function(e,t){e.exports=require(\"express\")},function(e,t){e.exports=require(\"formidable\")},function(e,t){e.exports=require(\"fs\")},function(e,t){e.exports=require(\"lodash\")},function(e,t){e.exports=require(\"body-parser\")},function(e,t){e.exports=require(\"cookie-parser\")},function(e,t){e.exports=require(\"compression\")},function(e,t){e.exports=require(\"cors\")},function(e,t){e.exports=require(\"helmet\")},function(e,t){e.exports=require(\"crypto\")},function(e,t,o){e.exports=o.p+\"6635b03b26d02dcb8f5a5e92f80b63c6.png\"},function(e,t){e.exports=require(\"jsonwebtoken\")},function(e,t){e.exports=require(\"express-jwt\")},function(e,t,o){e.exports=o(15)},function(e,t,o){\"use strict\";o.r(t);var r={env:\"production\",port:process.env.PORT||8080,jwtSecret:process.env.JWT_SECRET||\"your_secret_key\",mongoUri:process.env.MONGODB_URI||process.env.MONGODB_HOST||\"mongodb://\"+(process.env.IP||\"localhost\")+\":\"+(process.env.MONGODB_PORT||\"27017\")+\"/project\"},n=o(1),s=o.n(n),a=o(5),i=o.n(a),u=o(6),d=o.n(u),p=o(7),c=o.n(p),l=o(8),m=o.n(l),y=o(9),f=o.n(y),h=o(0),g=o.n(h),j=o(10),S=o.n(j);const w=new g.a.Schema({name:{type:String,trim:!0,required:\"Name is required\"},first_name:{type:String,trim:!0,required:\"First Name is required\"},last_name:{type:String,trim:!0,required:\"Last Name is required\"},email:{type:String,trim:!0,unique:\"Email already exists\",match:[/.+\\@.+\\..+/,\"Please fill a valid email address\"],required:\"Email is required\"},hashed_password:{type:String,required:\"Password is required\"},salt:String,updated:Date,created:{type:Date,default:Date.now},photo:{data:Buffer,contentType:String},accountType:{type:String,required:\"Account is required\"}});w.virtual(\"password\").set((function(e){this._password=e,this.salt=this.makeSalt(),this.hashed_password=this.encryptPassword(e)})).get((function(){return this._password})),w.path(\"hashed_password\").validate((function(e){this._password&&this._password.length<6&&this.invalidate(\"password\",\"Password must be at least 6 characters.\"),this.isNew&&!this._password&&this.invalidate(\"password\",\"Password is required\")}),null),w.methods={authenticate:function(e){return this.encryptPassword(e)===this.hashed_password},encryptPassword:function(e){if(!e)return\"\";try{return S.a.createHmac(\"sha1\",this.salt).update(e).digest(\"hex\")}catch(e){return\"\"}},makeSalt:function(){return Math.round((new Date).valueOf()*Math.random())+\"\"}};var b=g.a.model(\"User\",w),x=o(4),q=o.n(x);var _=e=>{let t=\"\";if(e.code)switch(e.code){case 11e3:case 11001:t=(e=>{let t;try{let o=e.message.substring(e.message.lastIndexOf(\".$\")+2,e.message.lastIndexOf(\"_1\"));t=o.charAt(0).toUpperCase()+o.slice(1)+\" already exists\"}catch(e){t=\"Unique field already exists\"}return t})(e);break;default:t=\"Something went wrong\"}else for(let o in e.errors)e.errors[o].message&&(t=e.errors[o].message);return t},v=o(2),B=o.n(v),I=o(3),O=o.n(I),C=o(11),D=o.n(C);var P=(e,t,o)=>{let r=new B.a.IncomingForm;r.keepExtensions=!0,r.parse(e,(e,o,r)=>{if(e)return t.status(400).json({error:\"Photo could not be uploaded\"});var n=new b(o);r.photo&&(n.photo.data=O.a.readFileSync(r.photo.path),n.photo.contentType=r.photo.type),n.save((function(e){return e?t.status(400).json({error:_(e)}):t.status(200).json({message:\"Successfully signed up!\"})}))})},T=(e,t,o,r)=>{b.findById(r).exec((r,n)=>{if(r||!n)return t.status(\"400\").json({error:\"User not found\"});e.profile=n,o()})},U=(e,t)=>(e.profile.hashed_password=void 0,e.profile.salt=void 0,e.profile.photo=void 0,t.json(e.profile)),A=(e,t)=>{b.find((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)}).select(\"name email updated created\")},F=(e,t,o)=>{e.profile.remove((e,o)=>{if(e)return t.status(400).json({error:_(e)});o.hashed_password=void 0,o.salt=void 0,t.json(o)})},k=(e,t,o)=>{let r=new B.a.IncomingForm;r.keepExtensions=!0,r.parse(e,(o,r,n)=>{if(o)return t.status(400).json({error:\"Photo could not be uploaded\"});var s=e.profile;(s=q.a.extend(s,r)).updated=Date.now(),n.photo&&(s.photo.data=O.a.readFileSync(n.photo.path),s.photo.contentType=n.photo.type),s.save((e,o)=>{if(e)return t.status(400).json({error:_(e)});s.hashed_password=void 0,s.salt=void 0,t.json(s)})})},$=(e,t,o)=>{if(e.profile.photo.data)return t.set(\"Content-Type\",e.profile.photo.contentType),t.send(e.profile.photo.data);o()},E=(e,t)=>t.sendFile(process.cwd()+D.a),M=o(12),R=o.n(M),N=o(13);var z={signin:(e,t)=>{b.findOne({email:e.body.email},(o,n)=>{if(o||!n)return t.status(\"401\").json({error:\"User not found\"});if(!n.authenticate(e.body.password))return t.status(\"401\").send({error:\"Email and password don't match.\"});const s=R.a.sign({_id:n._id},r.jwtSecret);return t.cookie(\"t\",s,{expire:new Date+9999}),t.json({token:s,user:{_id:n._id,name:n.name,email:n.email}})})},signout:(e,t)=>(t.clearCookie(\"t\"),t.status(\"200\").json({message:\"signed out\"})),requireSignin:o.n(N)()({secret:r.jwtSecret,userProperty:\"auth\"}),hasAuthorization:(e,t,o)=>{if(!(e.profile&&e.auth&&e.profile._id==e.auth._id))return t.status(\"403\").json({error:\"User is not authorized\"});o()}};const G=s.a.Router();G.route(\"/api/users\").get(A).post(P),G.route(\"/api/users/:userId\").get(z.requireSignin,U).put(z.requireSignin,z.hasAuthorization,k).delete(z.requireSignin,z.hasAuthorization,F),G.route(\"/api/usersPhoto/:userId\").get($,E),G.param(\"userId\",T);var H=G;const L=s.a.Router();L.route(\"/auth/signin\").post(z.signin),L.route(\"/auth/signout\").get(z.signout);var W=L;const J=new g.a.Schema({title:{type:String,required:\"Title is required\"},text:{type:String,required:\"Article is required\"},photo:{data:Buffer,contentType:String},author:{type:String,required:\"Author is required\",default:\"anonymous\"},comments:[{text:String,created:{type:Date,default:Date.now},postedBy:{type:g.a.Schema.ObjectId,ref:\"User\"},replyComment:[{text:String,created:{type:Date,default:Date.now},postedBy:{type:g.a.Schema.ObjectId,ref:\"User\"}}]}],createDate:{type:Date,default:Date.now}});var X=g.a.model(\"Blog\",J);var K=(e,t,o)=>{let r=new B.a.IncomingForm;r.keepExtensions=!0,r.parse(e,(e,o,r)=>{if(e)return t.status(400).json({error:\"Photo could not be uploaded\"});var n=new X(o);r.photo&&(n.photo.data=O.a.readFileSync(r.photo.path),n.photo.contentType=r.photo.type),n.save((function(e){return e?t.status(400).json({error:\"Blog Creation Failed\"}):t.status(200).json({message:\"BLog Created\"})}))})},Q=(e,t)=>{X.find((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)}).select(\"title text author\")},V=(e,t)=>(t.set(\"Content-Type\",e.details.photo.contentType),t.send(e.details.photo.data)),Y=(e,t,o,r)=>{X.findById(r).populate(\"comments.replyComment.postedBy\",\"_id name\").populate(\"comments.postedBy\",\"_id name\").exec((r,n)=>{if(r||!n)return t.status(\"400\").json({error:\"BLog not found\"});e.details=n,o()})},Z=(e,t,o)=>{let r=new B.a.IncomingForm;r.keepExtensions=!0,r.parse(e,(o,r,n)=>{o&&t.status(400).json({error:\"Photo could not be uploaded\"});var s=e.details;(s=q.a.extend(s,r)).updated=Date.now(),n.photo&&(s.photo.data=O.a.readFileSync(n.photo.path),s.photo.contentType=n.photo.type),s.save((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(s)})})},ee=(e,t)=>(e.details.photo=void 0,t.json(e.details)),te=(e,t,o)=>{e.details.remove((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})},oe=(e,t)=>{let o={};o.text=e.body.comment,o.postedBy=e.body.userId,X.findByIdAndUpdate(e.body.blogId,{$push:{comments:o}},{new:!0}).populate(\"comments.postedBy\",\"_id name\").select(\"title text author comments createDate\").exec((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})},re=(e,t)=>{let o=e.body.commentId;X.findByIdAndUpdate(e.body.blogId,{$pull:{comments:{_id:o}}},{new:!0}).exec((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})},ne=(e,t)=>{let o={};o.text=e.body.comment,o.postedBy=e.body.userId,X.findOneAndUpdate({\"comments._id\":e.body.commentId},{$push:{\"comments.$.replyComment\":o}},{safe:!0,upsert:!0,new:!0}).populate(\"comments.replyComment.postedBy\",\"_id name\").populate(\"comments.postedBy\",\"_id name\").select(\"title text author comments createDate\").exec((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})},se=(e,t)=>{let o=e.body.replyId;X.findOneAndUpdate({\"comments.replyComment._id\":o},{$pull:{\"comments.$.replyComment\":{_id:o}}},{safe:!0,upsert:!0,new:!0}).exec((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})};const ae=s.a.Router();ae.route(\"/api/blog\").get(z.requireSignin,Q).post(z.requireSignin,K),ae.route(\"/api/blog/:blogId\").get(z.requireSignin,ee).put(z.requireSignin,Z).delete(z.requireSignin,te),ae.route(\"/api/comment\").put(z.requireSignin,oe).delete(z.requireSignin,re),ae.route(\"/api/replycomment\").put(z.requireSignin,ne).delete(z.requireSignin,se),ae.route(\"/api/blogPhoto/:blogId\").get(V),ae.param(\"blogId\",Y);var ie=ae;const ue=new g.a.Schema({title:{type:String,required:\"Title is required\"},text:{type:String,required:\"Article is required\"},comments:[{text:String,created:{type:Date,default:Date.now},postedBy:{type:g.a.Schema.ObjectId,ref:\"User\"},replyComment:[{text:String,created:{type:Date,default:Date.now},postedBy:{type:g.a.Schema.ObjectId,ref:\"User\"}}]}],createDate:{type:Date,default:Date.now},category:{type:String,required:\"Category is required\"},photo:{data:Buffer,contentType:String},postedBy:{type:g.a.Schema.ObjectId,ref:\"User\"}});var de=g.a.model(\"Forum\",ue);var pe=(e,t,o)=>{let r=new B.a.IncomingForm;r.keepExtensions=!0,r.parse(e,(e,o,r)=>{if(e)return t.status(400).json({error:\"Photo could not be uploaded\"});let n=new de(o);r.photo&&(n.photo.data=O.a.readFileSync(r.photo.path),n.photo.contentType=r.photo.type),n.save((function(e){return e?t.status(500).json({error:\"Forum Creation Failed\"}):t.status(200).json({message:\"Forum Created\"})}))})},ce=(e,t)=>{de.find((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)}).populate(\"postedBy\",\"_id name\").select(\"title text postedBy category\")},le=(e,t)=>(t.set(\"Content-Type\",e.details.photo.contentType),t.send(e.details.photo.data)),me=(e,t,o,r)=>{de.findById(r).populate(\"comments.replyComment.postedBy\",\"_id name\").populate(\"comments.postedBy\",\"_id name\").populate(\"postedBy\",\"_id name\").exec((r,n)=>{if(r||!n)return t.status(\"400\").json({error:\"Forum not found\"});e.details=n,o()})},ye=(e,t,o)=>{let r=new B.a.IncomingForm;r.keepExtensions=!0,r.parse(e,(o,r,n)=>{if(o)return t.status(400).json({error:\"Photo could not be uploaded\"});let s=e.details;(s=q.a.extend(s,r)).updated=Date.now(),n.photo&&(s.photo.data=O.a.readFileSync(n.photo.path),s.photo.contentType=n.photo.type),s.save((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(s)})})},fe=(e,t)=>(e.details.photo=void 0,t.json(e.details)),he=(e,t,o)=>{e.details.remove((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})},ge=(e,t)=>{let o={};o.text=e.body.comment,o.postedBy=e.body.userId,de.findByIdAndUpdate(e.body.forumId,{$push:{comments:o}},{new:!0}).populate(\"comments.postedBy\",\"_id name\").populate(\"postedBy\",\"_id name\").exec((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})},je=(e,t)=>{let o=e.body.commentId;de.findByIdAndUpdate(e.body.forumId,{$pull:{comments:{_id:o}}},{new:!0}).exec((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})},Se=(e,t)=>{let o={};o.text=e.body.comment,o.postedBy=e.body.userId,de.findOneAndUpdate({\"comments._id\":e.body.commentId},{$push:{\"comments.$.replyComment\":o}},{safe:!0,upsert:!0,new:!0}).populate(\"comments.replyComment.postedBy\",\"_id name\").populate(\"comments.postedBy\",\"_id name\").populate(\"postedBy\",\"_id name\").exec((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})},we=(e,t)=>{let o=e.body.replyId;de.findOneAndUpdate({\"comments.replyComment._id\":o},{$pull:{\"comments.$.replyComment\":{_id:o}}},{safe:!0,upsert:!0,new:!0}).exec((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})},be=(e,t)=>{de.distinct(\"category\",{},(e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})},xe=(e,t)=>{de.find({category:e.body.category}).populate(\"postedBy\",\"_id name\").populate(\"comments.postedBy\",\"_id name\").populate(\"comments.replyComment.postedBy\",\"_id name\").exec((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})},qe=(e,t)=>{de.find({postedBy:e.body.userId}).populate(\"postedBy\",\"_id name\").populate(\"comments.postedBy\",\"_id name\").populate(\"comments.replyComment.postedBy\",\"_id name\").exec((e,o)=>{if(e)return t.status(400).json({error:_(e)});t.json(o)})};const _e=s.a.Router();_e.route(\"/api/forum\").get(z.requireSignin,ce).post(z.requireSignin,pe),_e.route(\"/api/forum/:forumId\").get(z.requireSignin,fe).put(z.requireSignin,ye).delete(z.requireSignin,he),_e.route(\"/api/message\").put(z.requireSignin,ge).delete(z.requireSignin,je),_e.route(\"/api/replymessage\").put(z.requireSignin,Se).delete(z.requireSignin,we),_e.route(\"/api/categories\").get(z.requireSignin,be),_e.route(\"/api/category\").post(z.requireSignin,xe),_e.route(\"/api/userForum\").post(z.requireSignin,qe),_e.route(\"/api/forumPhoto/:forumId\").get(le),_e.param(\"forumId\",me);var ve=_e;const Be=s()();Be.use((function(e,t,o){t.header(\"Access-Control-Allow-Origin\",\"*\"),t.header(\"Access-Control-Allow-Headers\",\"Origin, X-Requested-With, Content-Type, Accept\"),o()})),Be.use(i.a.json()),Be.use(i.a.urlencoded({extended:!0})),Be.use(d()()),Be.use(c()()),Be.use(f()()),Be.use(m()()),Be.use(\"/\",H),Be.use(\"/\",W),Be.use(\"/\",ie),Be.use(\"/\",ve),Be.get(\"/\",(e,t)=>{console.log(1)}),Be.use((e,t,o,r)=>{\"UnauthorizedError\"===e.name&&o.status(401).json({error:e.name+\": \"+e.message})});var Ie=Be;g.a.Promise=global.Promise,g.a.connect(r.mongoUri),g.a.connection.on(\"error\",()=>{throw new Error(`unable to connect to database: ${r.mongoUri}`)}),Ie.listen(r.port,e=>{e&&console.log(e),console.info(\"Server started on porst:\",r.port)})}]);","extractedComments":[]}